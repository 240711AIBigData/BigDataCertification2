# CHAPTER06 연습문제

SECTION01 단일 표본 검정
---
### ✏️ 문제
> 한 커피 제조회사에서는 새로 출시한 커피의 카페인 함량이 95mg 미만이라고 주장했다.<br>
> 그 주장이 사실인가를 알아보기 위해 25개의 커피 샘플을 무작위(랜덤)로 추출했다.<br>
> 커피 제조회사의 주장이 타당한지를 유의수준 5% 에서 검정하시오.

- 귀무가설(H₀) : μ >= 95mg (제조사의 주장이 틀렸다고 보는 관점)

  - 귀무가설은 대립가설을 반박할 기본적인 기준으로 설정(대립가설을 부정하는 형태)

- 대립가설(H₁) : μ < 95mg (제조사의 주장을 검증하려는 관점)


<br>

> 입력값
```python
  1. 표본 데이터의 평균
  
  2. Shapiro-Wilk 검정의 p-value
  
  3. 단일 표본 t-검정의 검정 통계량
  
  4. 단일 표본 t-검정의 p-value
  
  5. 유의수준 0.05 하에서 귀무가설을 기준으로 검정 결과를 채택/기각 중 선택
```

<br>

> 데이터
```python
  import pandas as pd
  df = pd.DataFrame({
      'Caffeine(mg)' : [
          94.2, 93.7, 95.5, 93.9, 94.0, 95.2, 94.7, 93.5, 92.8, 94.4,
          93.8, 94.6, 93.3, 95.1, 94.3, 94.9, 93.9, 94.8, 95.0, 94.2,
          93.7, 94.4, 95.1, 94.0, 93.6
      ]
  })
```

<br>

> 힌트
```python
  ttest_1samp()
```

<br>

#### 풀이
> 코드
```python
  # 1. 표본 평균
  print(df.mean())
  
  # 2. 정규성 검정
  from scipy import stats
  print(stats.shapiro(df['Caffeine(mg)']))
  
  # 3~5. 단일 표본 t-검정
  print(stats.ttest_1samp(df['Caffeine(mg)'], 95, alternative='less'))
  
  print(' ')
  
  statistic, pvalue = stats.ttest_1samp(df['Caffeine(mg)'], 95, alternative='less')
  print('{:.10f}'.format(pvalue))
```
- 지수 표기법을 일반 소수점 형태로 변경하기 위해 '{:.10f}'.format(pvalue) 사용

  - 소수 10번째 자리까지로 변경

> 결과
```python
  Caffeine(mg)    94.264
  dtype: float64
  ShapiroResult(statistic=0.9826578166170536, pvalue=0.9322031137746971)
  TtestResult(statistic=-5.501737036221897, pvalue=5.8686553916715e-06, df=24)
   
  0.0000058687
```
- Shapiro-Wilk 검정의 p-value 0.9826578166170536 > 0.05 : 데이터가 정규 분포를 따른다

- 단일 표본 t-검정의 검정 통게량 : -5.501737036221897, p-value : 0.0000058687(5.8686553916715e-06)

- 대립가설을 기준으로 df['Caffeine(mg)'] < 95 : alternative='less'

- p-value 0.00 < 유의수준 0.05 : 귀무가설 기각

<br>

> 정답
```python
  1. 표본 데이터의 평균 : 94.264
  
  2. Shapiro-Wilk 검정의 p-value : 0.9322031137746971
  
  3. 단일 표본 t-검정의 검정 통계량 : 5.501737036221897
  
  4. 단일 표본 t-검정의 p-value : 0.0000058687 (5.8686553916715e-06)
  
  5. 유의수준 0.05 하에서 귀무가설을 기준으로 검정 결과를 채택/기각 중 선택 : 기각 (p-value 0.00 < 유의수준 0.05)
```

<br>

---

<br>

SECTION02 독립 표본 검정
---
### ✏️ 문제
> 스마트폰 배터리의 충전 시간을 줄이기 위한 새로운 충전기를 개발했다. 개발된 충전기의 효과를 검정하기 위해<br>
> 스마트폰 사용자 집단을 두 그룹으로 나눠 한 그룹에는 새로운 충전기를 제공하고, 다른 그룹에는 기존 충전기를 제공했다.<br>
> 그 후 두 그룹의 평균 충전 완료 시간을 비교했다. 두 그룹 모두 충전 시간은 정규 분포를 따르며 분산은 같다고 가정한다.<br>
> 새로운 충전기가 더 빠르다고 할 수 있는지를 유의수준 5% 하에서 검정하시오.<br>
> (μ1 : 새로운 충전기 집단의 모평균, μ2 : 기존 충전기 집단의 모평균)

- 귀무가설(H₀) : μ1 >= μ2 (새로운 충전기가 더 빠르지 않다고 보는 관점)

  - 귀무가설은 대립가설을 반박할 기본적인 기준으로 설정(대립가설을 부정하는 형태)

- 대립가설(H₁) : μ1 < μ2 (새로운 충전기가 더 빠름을 검증하려는 관점)


<br>

> 입력값
```python
  1. 위 가설을 검정하기 위한 검정 통계량
  
  2. 위의 통계량에 대한 p-value
  
  3. 유의수준 0.05 하에서 귀무가설을 기준으로 검정의 결과를 채택/기각 중 선택
```

<br>

> 데이터
```python
  import pandas as pd
  df = pd.DataFrame({
      '충전기' : ['New'] * 10 + ['Old'] * 10,
      '충전시간' : [
          1.5, 1.6, 1.4, 1.7, 1.5, 1.6, 1.7, 1.4, 1.6, 1.5,
          1.7, 1.8, 1.7, 1.9, 1.8, 1.7, 1.8, 1.9, 1.7, 1.6
      ]
  })
  print(df.head(2))
```

> 결과
```python
     충전기  충전시간
  0  New   1.5
  1  New   1.6
```

<br>

> 힌트
```python
  ttest_ind()
```

<br>

#### 풀이
> 코드
```python
  # 1~3. 독립 표본 t-검정
  new_cond = df['충전기'] == 'New'
  old_cond = df['충전기'] == 'Old'
  print(df[new_cond]['충전시간'].head(2))
  print(df[old_cond]['충전시간'].head(2))
  
  print(' ')
  
  from scipy import stats
  print(stats.ttest_ind(df[new_cond]['충전시간'], df[old_cond]['충전시간'], alternative='less', equal_var=True))
```
- 스마트폰 충전기의 효과를 비교하는 데 있어서 두 독립된 집단 간의 평균을 비교하는데 초점

- 독립성 검정은 ttest_ind() 사용

  - 분산이 같다고 가정했기 때문에 equal_var=True 설정

> 결과
```python
  0    1.5
  1    1.6
  Name: 충전시간, dtype: float64
  10    1.7
  11    1.8
  Name: 충전시간, dtype: float64
   
  TtestResult(statistic=-4.582575694955849, pvalue=0.00011546547787696304, df=18.0)
```
- t-test 결과

  - p-value 0.00 < 유의수준 0.05 : 귀무가설 기각

<br>

> 정답
```python
  1. 위 가설을 검정하기 위한 검정 통계량 : -4.582575694955849
  
  2. 위의 통계량에 대한 p-value : 0.00011546547787696304
  
  3. 유의수준 0.05 하에서 귀무가설을 기준으로 검정의 결과를 채택/기각 중 선택 : 기각 (p-value 0.00 < 유의수준 0.05)
```

<br>

---

<br>

SECTION03 대응 표본 검정
---
### ✏️ 문제
> 연구소에서는 새로 개발한 교육과정에 참여하면 학습 시간이 단축된다고 주장한다.<br>
> 10명의 학생들을 대상으로 기존의 교육 방법과 새로운 교육 방법을 적용한 결과에 대해 유의수준 5% 에서<br>
> 새로운 교육방법이 교육 시간을 단축시켰는지 검정하시오. (단, 모집단은 정규 분포를 가정한다.)

- μd = (새로운 교육방법 - 기존 교육방법)의 평균

- 귀무가설(H₀) : μd >= 0 (새로운 교육방법의 학습 시간이 기존보다 길거나 같다고 보는 관점)

  - 귀무가설은 대립가설을 반박할 기본적인 기준으로 설정(대립가설을 부정하는 형태)

- 대립가설(H₁) : μd < 0 (새로운 교육방법이 학습 시간을 단축함을 검증하려는 관점)


<br>

> 입력값
```python
  1. μd 의 표본 평균 
  
  2. 위의 가설을 검정하기 위한 검정 통계량 
  
  3. 위의 통계량에 대한 p-value 
  
  4. 유의수준 0.05 하에서 귀무가설을 기준으로 검정의 결과를 채택/기각 중 선택 
```

<br>

> 데이터
```python
  import pandas as pd
  df = pd.DataFrame({
      'User' : list(range(1, 11)),
      '기존방법' : [60.4, 60.7, 60.5, 60.3, 60.8, 60.6, 60.2, 60.5, 60.7, 60.4],
      '새로운방법' : [59.8, 60.2, 60.1, 59.9, 59.7, 58.4, 57.0, 60.3, 59.6, 59.8]
  })
  print(df.head(2))
```

> 결과
```python
     User  기존방법  새로운방법
  0     1  60.4   59.8
  1     2  60.7   60.2
```

<br>

> 힌트
```python
  ttest_rel()
```

<br>

#### 풀이
> 코드
```python
  # 1. 표본 평균
  df['diff'] = df['새로운방법'] - df['기존방법']
  print(df['diff'].mean())
  
  # 2~4. 대응 표본 t-검정
  from scipy import stats
  print(stats.ttest_rel(df['새로운방법'], df['기존방법'], alternative='less'))
```
- μd : 새로운 방법 - 기존 방법

  - 차이 값을 diff 컬럼에 대입하고, 평균 구하기
 
- 대응 표본 t-검정은 ttest_rel() 사용

- μd 순서대로 새로운 방법, 기존 방법을 넣고, alternative 에는 대립가설 기준 첫 번째 값이 더 작아야 하므로 'less'

- t-test 결과

  - p-vlaue 0.00 < 유의수준 0.05 : 귀무가설 기각

> 결과
```python
  -1.0300000000000005
  TtestResult(statistic=-3.407973078114844, pvalue=0.0038872633380070652, df=9)
```

<br>

> 정답
```python
  1. μd 의 표본 평균 : -1.0300000000000005
  
  2. 위의 가설을 검정하기 위한 검정 통계량 : -3.407973078114844
  
  3. 위의 통계량에 대한 p-value : 0.0038872633380070652
  
  4. 유의수준 0.05 하에서 귀무가설을 기준으로 검정의 결과를 채택/기각 중 선택 : 기각 (p-vlaue 0.00 < 유의수준 0.05)
```

<br>

---

<br>

SECTION04 일원 분산 검정
---
### ✏️ 문제
> 4개의 중학교에서 다른 교육 방법을 사용해 학생들에게 수학을 가르쳤다.<br>
> 각 중학교의 학생들이 받은 교육 후의 수학 성적은 다음과 같다.<br>
> 이 4개의 교육 방법에 따른 성적 차이가 통계적으로 유의미한지 5% 유의수준에서 검정하시오.

- 귀무가설(H₀) : 모든 중학교의 학생들의 수학 성적은 평균은 동일하다

- 대립가설(H₁) : 적어도 2개 중학교의 학생들의 수학 성적 평균은 다르다

  - 4개 교육 방법 중 최소한 하나의 방법이 다른 방법들과 성적에서 차이가 있다

<br>

> 입력값
```python
  1. 각 그룹의 수학 성적에 대해 Shapiro-Wilk 검정을 통한 정규성 확인 후 그 결과의 p-value
  
  2. 4개 그룹의 수학 성적이 등분산성을 갖는지 확인하기 이ㅜ해 Levene 검정 후 p-value
  
  3. 유의수준 0.05 하에서 귀무가설을 기준으로 검정 결과를 채택/기각 중 선택
  
  4. 그룹 변수의 자유도
  
  5. 잔차의 자유도
  
  6. 성적의 제곱합
  
  7. 성적의 평균 제곱
  
  8. F-통계량 값
  
  9. 성적에 대한 p-value
```

<br>

> 데이터
```python
  import pandas as pd
  df = pd.read_csv('./data/math.csv')
  print(df.head())
```

> 결과
```python
      groups  scores
  0  group_A      85
  1  group_A      88
  2  group_A      90
  3  group_A      82
  4  group_A      87
```

<br>

> 힌트
```python
  shapiro(), levene(), f_oneway(), ols(), anova_lm()
```

<br>

#### 풀이
> 코드
```python
  from scipy import stats
  
  # 1. Shapiro-Wilk 검정 (정규성)
  condA = df['groups'] == 'group_A'
  print(stats.shapiro(df[condA]['scores']))
  
  condB = df['groups'] == 'group_B'
  print(stats.shapiro(df[condB]['scores']))
  
  condC = df['groups'] == 'group_C'
  print(stats.shapiro(df[condC]['scores']))
  
  condD = df['groups'] == 'group_D'
  print(stats.shapiro(df[condD]['scores']))
  
  print('')
  
  # 2. Levene 검정 (등분산성)
  print(stats.levene(df[condA]['scores'], df[condB]['scores'], df[condC]['scores'], df[condD]['scores']))
  
  print('')
  
  # 일원 분산 분석을 위한 모델 학습
  from statsmodels.formula.api import ols
  model = ols('scores ~ groups', df).fit()
  
  # 3~9. ANOVA 테이블
  from statsmodels.stats.anova import anova_lm  # 선형 모델을 명시적으로 생성한 후, 이를 anova_lm() 함수에 전달
  print(anova_lm(model))
```
- shapiro() 활용해 정규성 검정 실시

- 4개 그룹의 성적이 등분산성을 갖는지 Levene 검정 사용해 확인

- ols() 사용해 모델 학습 후, ANOVA 테이블 출력

  - 자유도(df), 총 제곱합(sum_sq), 평균 제곱(mean_sq), F-통계량(F), p-value(PR(>F))
 
  - 독립변수 groups 변수는 문자 ⇒ C() 사용여부와 관계없이 결과는 같음

> 결과
```python
  ShapiroResult(statistic=0.9715896670696531, pvalue=0.9051800443853569)
  ShapiroResult(statistic=0.9499422438060351, pvalue=0.6678172590861611)
  ShapiroResult(statistic=0.9299424104842702, pvalue=0.44732595113862045)
  ShapiroResult(statistic=0.9065684572704982, pvalue=0.25824165549017347)
  
  LeveneResult(statistic=1.757685352622062, pvalue=0.17270284963232108)
  
              df  sum_sq     mean_sq          F        PR(>F)
  groups     3.0   411.8  137.266667  34.174274  1.240642e-10
  Residual  36.0   144.6    4.016667        NaN           NaN
```
- ShapiroResult 의 각 pvalue 들 > 0.05 : 정규성에 만족한다

- LeveneResult 의 pvalue > 0.05 : 등분산성에 만족한다

- 일원 분산 분석 결과, p-value(0.00) < 유의수준(0.05) : 귀무가설 기각

<br>

> 정답
```python
  1. 각 그룹의 수학 성적에 대해 Shapiro-Wilk 검정을 통한 정규성 확인 후 그 결과의 p-value
      : 0.9051800443853569, 0.6678172590861611, 0.44732595113862045, 0.25824165549017347
  
  2. 4개 그룹의 수학 성적이 등분산성을 갖는지 확인하기 위해 Levene 검정 후 p-value : 0.17270284963232108
  
  3. 유의수준 0.05 하에서 귀무가설을 기준으로 검정 결과를 채택/기각 중 선택 : 기각 (p-value 0.00 < 유의수준 0.05)
  
  4. 그룹 변수의 자유도 : 3
  
  5. 잔차의 자유도 : 36
  
  6. 성적의 제곱합 : 411.8
  
  7. 성적의 평균 제곱 : 137.266667
  
  8. F-통계량 값 : 34.174274
  
  9. 성적에 대한 p-value : 1.240642e-10 (0.000000000124)
```

<br>

---

<br>

SECTION05 이원 분산 검정
---
### ✏️ 문제
> 토마토 연구소에서는 토마토의 수확량을 늘리기 위해 세 가지 다른 비료 유형과 네 가지 다른 물 주기를 실험하고자 한다.<br>
> 연구소에서는 12개의 토마토 식물을 무작위로 선택해 각 조합에 대해 반복적으로 실험을 수행했다.<br>

- 비료 유형에 따른 효과

  - 귀무가설(H₀) : 모든 비료 유형의 토마토 수확량 평균은 동일하다
  
  - 대립가설(H₁) : 적어도 2개 이상의 비료 유형에서의 토마토 수확량 평균이 다르다
 
- 물 주기에 따른 효과

  - 귀무가설(H₀) : 모든 물 주기의 토마토 수확량 평균은 동일하다
  
  - 대립가설(H₁) : 적어도 2개 이상의 물 주기에서의 토마토 수확량 평균이 다르다
 
- 비료 유형과 물 주기 간의 상호작용 효과

  - 귀무가설(H₀) : 비료 유형과 물 주기 간의 상호작용은 토마토 수확량에 영향을 미치지 않는다
  
  - 대립가설(H₁) : 비료 유형과 물 주기 간의 상호작용은 토마토 수확량에 영향을 미친다

<br>

> 입력값
```python
  1. 비료 유형에 따른 토마토 수확량의 평균에 차이가 있는지를 검정하기 위한 검정 통계량
  
  2. 위의 통계량에 대한 p-value
  
  3. 위의 검정 결과를 유의수준 0.05 하에서 귀무가설을 기준으로 채택/기각 중 선택
  
  4. 물 주기에 따른 토마토 수확량의 평균에 차이가 있는지를 검정하기 위한 검정 통계량
  
  5. 위의 통계량에 대한 p-value
  
  6. 위의 검정 결과를 유의수준 0.05 하에서 귀무가설 기준으로 채택/기각 중 선택
  
  7. 비료 유형과 물 주기 간의 상호작용이 토마토 수확량에 영향이 있는지 검정하기 위한 검정 통계량
  
  8. 위의 통계량에 대한 p-value
  
  9. 위의 검정 결과를 유의수준 0.05 하에서 귀무가설을 기준으로 채택/기각 중 선택 
```

<br>

> 데이터
```python
  import pandas as pd
  df = pd.read_csv('./data/tomato2.csv')
  print(df.head())
```

> 결과
```python
    비료유형  물주기  수확량
  0    A    1  514
  1    A    1  480
  2    A    1  507
  3    A    2  452
  4    A    2  526
```

<br>

> 힌트
```python
  ols(), anova_lm()
```

<br>

#### 풀이
> 코드
```python
  # R-style 공식(Syntax) 사용하여 모델을 간결하게 정의
  import statsmodels.api as sm
  from statsmodels.formula.api import ols
  
  # 1~9 이원 분산 분석
  model = ols('수확량 ~ C(비료유형) * C(물주기)', data=df).fit()
  anova_table = sm.stats.anova_lm(model)
  print(anova_table)
```

> 결과
```python
                    df        sum_sq      mean_sq         F    PR(>F)
  C(비료유형)          2.0   5251.722222  2625.861111  3.184685  0.059334
  C(물주기)           3.0   9057.000000  3019.000000  3.661490  0.026460
  C(비료유형):C(물주기)   6.0   4271.833333   711.972222  0.863491  0.535426
  Residual        24.0  19788.666667   824.527778       NaN       NaN
```
- 비료 유형에 대한 분석 F-통계량(3.184685), p-value(0.059334) : 귀무가설 채택

- 물 주기에 대한 분석 F-통계량(3.661490), p-value(0.026460) : 귀무가설 기각

- 비료 유형과 물 주기의 상호작용 효과에 대한 분석 F-통계량(0.863491), p-value(0.535426) : 귀무가설 채택

- df(자유도), sum_sq(총 제곱합), mean_sq(평균 제곱)

<br>

> 정답
```python

  1. 비료 유형에 따른 토마토 수확량의 평균에 차이가 있는지를 검정하기 위한 검정 통계량 : 3.184685
  
  2. 위의 통계량에 대한 p-value : 0.059334
  
  3. 위의 검정 결과를 유의수준 0.05 하에서 귀무가설을 기준으로 채택/기각 중 선택 : 채택 (0.059334 > 0.05)
  
  4. 물 주기에 따른 토마토 수확량의 평균에 차이가 있는지를 검정하기 위한 검정 통계량 : 3.661490
  
  5. 위의 통계량에 대한 p-value : 0.026460
  
  6. 위의 검정 결과를 유의수준 0.05 하에서 귀무가설 기준으로 채택/기각 중 선택 : 기각 (0.026460 < 0.05)
  
  7. 비료 유형과 물 주기 간의 상호작용이 토마토 수확량에 영향이 있는지 검정하기 위한 검정 통계량 : 0.863491
  
  8. 위의 통계량에 대한 p-value : 0.535426
  
  9. 위의 검정 결과를 유의수준 0.05 하에서 귀무가설을 기준으로 채택/기각 중 선택 : 채택 (0.535426 > 0.05)
```

<br>

<details>
  <summary>💡 statsmodels에서 anova_lm() 함수를 사용할 때, statsmodels.stats.anova 와 statsmodels.formula.api.ols </summary>

<br>

|특징|anova_lm 직접 사용|ols() + 공식 사용|
|:-:|:-:|:-:|
|입력 방식|수동으로 회귀 모델(sm.OLS) 생성 후 ANOVA 적용|공식(Syntax)로 범주형 변수와 상호작용 등을 처리|
|범주형 변수 처리|직접 변환 필요|자동으로 처리|
|상호작용 처리|수동 처리 필요|* 연산자로 간단히 처리|
|유연성|데이터 전처리 및 사용자 정의 가능|제한적(공식 기반)|
|코드 간결성|상대적으로 복잡|간단하고 직관적|

</details>

<br>

---

<br>

SECTION06 적합도 검정
---



<br>

---

<br>

SECTION07 독립성 검정
---



<br>

---

<br>

SECTION08 다중 선형 회귀
---



<br>

---

<br>

SECTION09 로지스틱 회귀
---



<br>
















