# CHAPTER05 로지스틱 회귀 분석
- 범주형 종속변수를 대상으로 하는 통계적 분석 방법

- 분류 문제를 해결하는 데 자주 사용

- 독립변수들의 선형 조합을 통해 사건의 발생 여부나 확률을 예측

  - 예측된 확률을 바탕으로 두 가지 범주 중 하나로 분류
 
- '회귀'라는 용어가 사용되지만, 로지스틱 회귀는 분류 모델에 속함

<br>

SECTION01 로지스틱 회귀 분석
---
- 로지스틱 회귀 모델은 스태츠모델즈(statsmodels) 라이브러리 사용

- ex) 의료 데이터셋에서 환자의 여러 임상지표를 바탕으로 특정 질병의 유무를 예측하는 분류 모델 생성 가능


<br>

### 01. logit 모델
- logit() 함수 사용

  - 종속변수가 이진 형태인 경우(결과가 두 가지 범주 중 하나로 나눠지는 상황)
  
    - 독립변수들과의 관계를 모델링하는 데 사용됨

> statsmodels 에서 R 스타일의 공식을 사용해 logit 모델 정의
```python
  logit('종속변수 ~ 독립변수1 + 독립변수2 + ...', data=df).fit()
```
- 종속변수와 독립변수 사이에는 물결(~) 표시를 사용해 관계를 나타냄

  - 컬럼명은 따옴표 없이 작성
 
- **종속변수** : 모델에서 결과로 예측하고자 하는 이진형 변수

  - ex) 어떤 사건의 발생 여부(1 또는 0)
 
- **독립변수** : 종속변수에 영향을 미칠 것으로 예상되는 변수들

  - 종속변수를 예측하기 위해 모델에 포함됨
 
- **data** : 모델이 변수들을 찾아 사용할 데이터프레임 df 명시

- **.fit()** : 이 함수(메서드)는 로지스틱 회귀 모델이 주어진 데이터에 학습(적합)시키는 과정 수행

<br>

#### ✏️ 문제
> 다음은 특정 질병(disease)의 유무를 나타내는 환자 데이터셋이다. 이 데이터를 바탕으로 각 소문제의 값을 구하시오.

- 데이터

  - 독립변수 : 나이(age), 체질량 지수(bmi), 흡연(smoker) 여부, 활동 수준(activity_level)
 
  - 종속변수 : 특정 질병(disease)의 유무
 
> 코드
```python
  import pandas as pd
  df = pd.read_csv('./data/health_survey.csv')
  print(df.head())
```

> 결과
```python
     age        bmi  smoker  activity_level  disease
  0   62  35.179089       0               0        1
  1   65  18.576042       0               2        1
  2   71  33.178426       0               1        1
  3   18  37.063007       1               2        0
  4   21  17.613266       0               0        0
```

<br>

**1. 로지스틱 회귀 모델을 사용하여 age 와 bmi 를 독립변수로 활용해 질병(disease)의 발생 여부 예측**
- 주어진 health_survey.csv 데이터셋을 바탕으로 bmi 변수의 계수 값

  - 로지스틱 회귀 모델 구축
 
    - statsmodels 의 logit() 함수 사용해 age 와 bmi 를 독립변수로 하고, disease 를 종속변수로 하는 로지스틱 회귀 모델 구축
   
    - disease 의 발생 확률을 예측하기 위해 독립변수들의 선형 조합 사용
   
  - 모델 학습
 
    - 모델을 데이터에 학습(적합)시키기 위해 .fit() 함수(메서트) 사용
   
  - 결과
 
    - \.summary() 를 통해 얻은 모델 요약에서 bmi 변수의 계수(coef) 값은 약 0.0563 으로 나타남

> 코드
```python
  from statsmodels.formula.api import logit
  import statsmodels as sm
  
  model = logit('disease ~ age + bmi', data=df).fit()
  print(model.summary())
```

> 결과
```python
  Optimization terminated successfully.
           Current function value: 0.643725
           Iterations 5
                             Logit Regression Results                           
  ==============================================================================
  Dep. Variable:                disease   No. Observations:                 1000
  Model:                          Logit   Df Residuals:                      997
  Method:                           MLE   Df Model:                            2
  Date:                Mon, 18 Nov 2024   Pseudo R-squ.:                 0.04996
  Time:                        15:58:46   Log-Likelihood:                -643.72
  converged:                       True   LL-Null:                       -677.58
  Covariance Type:            nonrobust   LLR p-value:                 1.984e-15
  ==============================================================================
                   coef    std err          z      P>|z|      [0.025      0.975]
  ------------------------------------------------------------------------------
  Intercept     -1.8700      0.289     -6.482      0.000      -2.435      -1.305
  age            0.0177      0.004      4.747      0.000       0.010       0.025
  bmi            0.0563      0.009      6.418      0.000       0.039       0.074
  ==============================================================================
```

<br>

**2. 추정된 로지스틱 회귀 모델에서 bmi 변수가 한 단위 증가할 때 질병 발생의 오즈비(Odds Ratio) 값**
- 오즈비 계산 방법

  - 로지스틱 회귀 모델에서 'bmi' 변수의 계수 값을 지수 함수 'np.exp()' 사용해 오즈비(Odds Ratio)로 변환
 
- 계수 값 확인

  - model.summary() 또는 model.params['bmi'] 의 로지스틱 회귀 모델에서 bmi 변수의 계수 값은 약 0.0563
 
- 결과

  - np.exp(model.params['bmi']) : bmi 변수의 계수 값을 지수화해 오즈비 계산
 
  - 오즈비는 bmi 가 한 단위 증가할 때 질병 발생의 오즈가 얼마나 증가하는지를 나타내는 비율

> 코드
```python
  import numpy as np
  print(model.params['bmi'])
  print(np.exp(model.params['bmi']))
```

> 결과
```python
  0.056333879687088535
  1.057950853075076
```

<br>

**3. 로그 우도(Log-Likelihood)를 구하는 방법과 잔차이탈도(Deviance)를 계산하는 방법**
- 로그 우도는 모델의 요약 결과에서 summary() 함수를 통해 확인 가능

  - 정확한 값을 직접 확인하기 위해서는 model.llf 사용
 
> 코드
```python
  print(model.llf)
```

> 결과
```python
  -643.7246164682088
```

<br>

- 로그 우도에 -2 를 곱하면 잔차이탈도

> 코드
```python
  print(-2 * model.llf)
```

> 결과
```python
  1287.4492329364175
```

<br>

**4. 정확도와 오류율**
- 정확도(Accuracy) : 올바르게 분류된 데이터의 비율

  - 만약 100개의 데이터가 있고, 그 중 90개를 올바르게 예측했다면 정확도는 0.9(90%)
 
- 오류율(Error Rate) : 잘못 분류된 데이터의 비율(1 - 정확도)

  - 만약 100개의 데이터 중 10개를 잘못 예측했다면 오류율은 0.1(10%)

---

<br>

SECTION02 오즈와 오즈비
---
### 01. 오즈(Odds)
- 정의 : 어떤 사건이 발생할 확률과 그 사건이 발생하지 않을 확률의 비율

- 수식 : 사건 A의 발생 확률을 P(A)라고 할 때 오즈 = P(A) / 1 - P(A)

- 예시 : 어떤 사건의 발생 확률이 0.75 라면 이 사건의 오즈는 0.75 / 0.25 = 3

  - 사건이 발생할 확률이 발생하지 않을 확률보다 세 배 높다는 의미

<br>

### 02. 오즈비(Odds Ratio)
- 정의 : 두 그룹의 오즈 간의 비율

  - 한 그룹에서 어떤 사건이 발생할 오즈가 다른 그룹에 비해 얼마나 더 큰지 나타냄
 
- 수식 : 두 사건 A 와 B 에 대한 오즈비 = 오즈(A) / 오즈(B)

- 예시 : 한 그룹에서 어떤 사건의 오즈가 2, 다른 그룹에서 같은 사건의 오즈가 1 이라면, 오즈비 = 2/1 = 2

  - 첫 번째 그룹에서 사건이 발생할 확률이 두 번째 그룹에 비해 두 배 높다는 의미
 
    - 오즈비 > 1 : 특정 조건 또는 노출이 사건 발생 가능성을 증가시킴
   
    - 오즈비 = 1 : 특정 조건 또는 노출ㄹ이 사건 발생 가능성에 영향을 미치지 않음
   
    - 오즈비 < 1 : 특정 조건 또는 노출이 사건 발생 가능성을 감소시킴

<br>




